@inject IJSRuntime JS
@implements IAsyncDisposable

<swiper-container @ref="_swiperContainer" @attributes="Attributes">
    @ChildContent
</swiper-container>

@code {
    private ElementReference _swiperContainer;
    private IJSObjectReference? _jsSwiper;

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? Attributes { get; set; }

    public async Task SlidePrevAsync()
    {
        if (_jsSwiper is not null)
            await _jsSwiper.InvokeVoidAsync("slidePrev");
    }

    public async Task SlideNextAsync()
    {
        if (_jsSwiper is not null)
            await _jsSwiper.InvokeVoidAsync("slideNext");
    }

    public async ValueTask DisposeAsync()
    {
        await DisposeAsyncCore().ConfigureAwait(false);
        GC.SuppressFinalize(this);
    }

    protected virtual async ValueTask DisposeAsyncCore()
    {
        if (_jsSwiper is not null)
        {
            await _jsSwiper.DisposeAsync().ConfigureAwait(false);
        }
        _jsSwiper = null;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await using var module = await JS.InvokeAsync<IJSObjectReference>("import", "./Components/Swiper/SwiperContainer.razor.js");
            _jsSwiper = await module.InvokeAsync<IJSObjectReference>("getSwiper", _swiperContainer);
        }
    }
}
